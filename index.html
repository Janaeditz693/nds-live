<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NDS LIVE | Vellore Bulls</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700;900&family=Montserrat:wght@300;400;600;700&family=Mukta+Malar:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6319216180839023"
     crossorigin="anonymous"></script>
    <style>
        :root { --bg-black: #000000; --card-grey: #121212; --input-bg: #1a1a1a; --input-border: #333333; --text-white: #ffffff; --text-grey: #888888; --brand-gold: #ffc107; --danger-red: #ff4444; }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg-black); color: var(--text-white); font-family: 'Inter', sans-serif; padding-bottom: 80px; }
        
        /* HEADER */
        header { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; background: var(--bg-black); position: sticky; top: 0; z-index: 100; border-bottom: 1px solid #111; }
        .logo { font-family: 'Cinzel', serif; font-size: 24px; color: var(--brand-gold); text-transform: uppercase; }
        .lang-btn { border: 1px solid var(--brand-gold); color: var(--brand-gold); padding: 5px 12px; border-radius: 4px; font-size: 13px; background: transparent; margin-right: 15px; cursor: pointer; font-weight: bold; }
        .profile-icon { width: 35px; height: 35px; background: #333; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #fff; cursor: pointer; font-size: 14px; }
        .profile-icon.active { background: var(--brand-gold); color: #000; }

        /* LOADING */
        #loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 5000; flex-direction: column; }
        .spinner { border: 4px solid #333; border-top: 4px solid var(--brand-gold); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* CARDS */
        .feed-container { padding: 0 15px; min-height: 50vh; }
        .card { background-color: var(--card-grey); border-radius: 12px; padding: 15px; margin-bottom: 20px; border: 1px solid #222; position: relative; }
        .card-header { display: flex; gap: 12px; margin-bottom: 12px; align-items: center; }
        .avatar { width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 18px; color: #000; }
        .avatar.nds { background: var(--brand-gold); } .avatar.user { background: #fff; }
        .user-info h4 { font-size: 16px; font-weight: 700; color: #fff; margin-bottom: 2px; }
        .user-info span { font-size: 13px; color: var(--text-grey); display: block; }
        .card-content img, .card-content video { width: 100%; border-radius: 8px; margin-top: 5px; max-height: 450px; object-fit: cover; cursor: pointer; }
        
        /* LIVE SPECIFIC */
        .live-footer { display: flex; justify-content: space-between; align-items: flex-end; margin-top: 15px; padding-top: 10px; border-top: 1px solid #222; }
        .bull-name { color: var(--brand-gold); font-size: 20px; font-weight: 700; text-transform: uppercase; font-family: 'Cinzel', serif; }
        .bull-time { color: #fff; font-size: 42px; font-weight: 300; line-height: 1; }
        .bull-time small { font-size: 20px; font-weight: 400; color: #888; }
        
        /* SOCIAL */
        .card-social { display: flex; justify-content: space-between; align-items: center; margin-top: 15px; padding-top: 12px; border-top: 1px solid #222; }
        .social-btn { background: none; border: none; color: var(--text-grey); font-size: 14px; cursor: pointer; display: flex; align-items: center; gap: 6px; }
        .social-btn:hover, .social-btn.liked { color: var(--danger-red); }
        .card-desc { color: #ddd; font-size: 14px; margin-top: 10px; line-height: 1.5; white-space: pre-wrap; }
        .read-more-btn { color: var(--brand-gold); font-size: 12px; font-weight: bold; cursor: pointer; margin-left: 5px; }

        /* COMMENTS */
        .comments-section { margin-top: 15px; padding-top: 10px; border-top: 1px dashed #333; display: none; }
        .comments-section.open { display: block; }
        .comment-item { font-size: 13px; color: #ccc; margin-bottom: 8px; }
        .comment-item b { color: var(--brand-gold); margin-right: 5px; }
        .comment-input-box { display: flex; gap: 10px; margin-top: 10px; }
        .comment-input { flex: 1; background: #222; border: none; padding: 8px 12px; border-radius: 20px; color: #fff; font-size: 13px; outline: none; }
        .comment-send { background: var(--brand-gold); color: #000; border: none; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; }

        /* AUTH & ADMIN */
        .auth-container { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 70vh; padding: 20px; }
        .auth-card { background: var(--card-grey); padding: 30px; border-radius: 12px; border: 1px solid #222; width: 100%; max-width: 400px; text-align: center; }
        .auth-title { font-size: 24px; font-weight: 800; color: var(--brand-gold); margin-bottom: 20px; }
        .auth-link { color: var(--text-grey); font-size: 14px; margin-top: 15px; display: block; cursor: pointer; }
        
        .admin-header { display: flex; justify-content: space-between; align-items: center; padding: 20px; }
        .admin-title { font-size: 24px; font-weight: 800; color: #fff; }
        .exit-btn { color: #fff; font-size: 14px; text-decoration: none; cursor: pointer; }
        
        /* TABS (Fixed Style) */
        .admin-tabs { display: flex; background: #111; border-radius: 8px; margin: 0 20px 20px 20px; padding: 4px; border: 1px solid #222; }
        .admin-tab { flex: 1; text-align: center; padding: 10px; color: #888; font-size: 14px; font-weight: 600; cursor: pointer; border-radius: 6px; }
        .admin-tab.active { background: var(--brand-gold); color: #000; }
        
        .sub-tab-container { display: flex; background: #111; margin: 0 15px 15px 15px; border-radius: 8px; padding: 4px; border: 1px solid #333; }
        .sub-tab-btn { flex: 1; padding: 10px; background: transparent; color: #777; border: none; cursor: pointer; border-radius: 6px; font-weight: 600; font-size: 13px; }
        .sub-tab-btn.active { background: var(--brand-gold); color: #000; }

        .admin-card { background: var(--card-grey); margin: 0 20px 20px 20px; padding: 20px; border-radius: 12px; border: 1px solid #222; }
        .admin-input-group { margin-bottom: 15px; }
        input, textarea, select { width: 100%; background: var(--input-bg); border: 1px solid var(--input-border); color: #fff; padding: 15px; border-radius: 8px; font-size: 14px; outline: none; font-family: 'Inter', sans-serif; }
        .btn-save { width: 100%; background: var(--brand-gold); color: #000; border: none; padding: 15px; font-weight: 800; font-size: 16px; border-radius: 8px; cursor: pointer; margin-bottom: 10px; }
        .btn-cancel { width: 100%; background: #333; color: #fff; border: none; padding: 10px; font-weight: 600; border-radius: 8px; cursor: pointer; display: none; }
        
        .existing-section { margin: 20px; border-top: 1px solid #333; padding-top: 20px; }
        .existing-title { color: var(--brand-gold); font-size: 18px; font-weight: 800; margin-bottom: 15px; }
        .existing-item { display: flex; align-items: center; justify-content: space-between; background: #000; border: 1px solid #333; padding: 10px; border-radius: 8px; margin-bottom: 10px; }
        .existing-thumb { width: 50px; height: 50px; border-radius: 4px; object-fit: cover; margin-right: 15px; background: #222; }
        .existing-info { flex: 1; }
        .existing-name { display: block; color: #fff; font-weight: 600; font-size: 14px; }
        .existing-meta { display: block; color: #666; font-size: 12px; margin-top: 2px; text-transform: uppercase; }
        .action-buttons { display: flex; gap: 8px; }
        .btn-action { padding: 6px 12px; border-radius: 4px; border: none; font-weight: bold; font-size: 12px; cursor: pointer; }
        .btn-edit { background: #333; color: #fff; border: 1px solid #444; }
        .btn-del { background: var(--danger-red); color: #fff; }
        .exit-btn {padding: 13px; background-color: #ffffff; border-radius: 10px;}

        /* UTILS */
        .fab { position: fixed; bottom: 80px; right: 20px; width: 55px; height: 55px; background-color: var(--brand-gold); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; color: #000; cursor: pointer; z-index: 90; }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: none; justify-content: center; align-items: center; z-index: 2000; }
        .modal-content { background: #111; padding: 25px; border-radius: 12px; width: 90%; max-width: 350px; border: 1px solid var(--brand-gold); max-height: 80vh; overflow-y: auto; }
        .modal-title { font-size: 20px; font-weight: bold; color: var(--brand-gold); margin-bottom: 20px; text-transform: uppercase; text-align: center; }
        .lightbox-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; display: none; justify-content: center; align-items: center; z-index: 3000; }
        .lightbox-content { width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; }
        .lightbox-close { position: absolute; top: 20px; right: 20px; color: #fff; font-size: 30px; cursor: pointer; z-index: 3001; background: rgba(0,0,0,0.5); width: 40px; height: 40px; border-radius: 50%; text-align: center; line-height: 40px; }
        
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background-color: #000; border-top: 1px solid #222; display: flex; justify-content: space-around; padding: 15px 0; z-index: 100; user-select: none; }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: var(--text-grey); font-size: 12.5px; gap: 5px; cursor: pointer; background: none; border: none; }
        .nav-item.active { color: var(--brand-gold); }
        .page-section, .sub-content, .admin-form-container, .user-form-section { display: none; }
        .page-section.active, .sub-content.active, .admin-form-container.active, .user-form-section.active { display: block; }
        .file-input-wrapper { position: relative; margin-bottom: 15px; background: var(--input-bg); border: 1px solid var(--input-border); border-radius: 8px; padding: 10px; display: flex; align-items: center; }
        input[type="file"] { position: absolute; left: 0; top: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; }
        .file-custom-btn { background: #fff; color: #000; padding: 6px 12px; border-radius: 4px; font-size: 13px; margin-right: 10px; font-weight: 600; }
        .file-name { color: #fff; font-size: 14px; font-weight: 500; }
        .btn-logout { margin-top: 15px; background: var(--danger-red); color: #fff; border: none; padding: 10px 0; width: 25%; font-weight: 700; border-radius: 8px; cursor: pointer; }
        /* Profile Layout */
        .profile-hero { text-align: center; padding: 30px 20px; background: var(--card-grey); margin-bottom: 20px; border-bottom: 1px solid #222; }
        .profile-big-avatar { width: 80px; height: 80px; background: var(--brand-gold); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; font-weight: bold; color: #000; margin: 0 auto 15px auto; }
        
        /* DELETE BUTTON STYLING FOR ADMIN */
        .delete-btn { position: absolute; top: 10px; right: 10px; background: rgba(255, 0, 0, 0.8); color: white; padding: 5px 10px; border-radius: 4px; font-size: 12px; border:none; cursor: pointer; z-index: 10; }
    
    /* FOLDER STYLES */
.folder-header {
    background: #1a1a1a;
    border: 1px solid #333;
    padding: 15px;
    margin-bottom: 5px;
    border-radius: 8px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    color: var(--brand-gold);
    font-family: 'Cinzel', serif;
    font-size: 16px;
    transition: background 0.3s;
}
.folder-header:hover { background: #222; }
.folder-content {
    display: none; /* Hidden by default */
    padding: 10px 0;
    border-left: 2px solid var(--brand-gold);
    margin-left: 10px;
    padding-left: 10px;
}
.folder-content.open { display: block; }
    
.secret-footer {
    text-align: center;
}

/* MORE PAGE STYLES */
.more-link {
    background: #1a1a1a;
    border: 1px solid #333;
    padding: 15px;
    margin-bottom: 10px;
    border-radius: 8px;
    color: #fff;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.more-link:hover { border-color: var(--brand-gold); color: var(--brand-gold); }
.more-content {
    display: none;
    background: #111;
    padding: 15px;
    border-radius: 8px;
    border: 1px solid #333;
    margin-bottom: 15px;
    color: #ccc;
    font-size: 13px;
    line-height: 1.6;
}
.more-content.open { display: block; }

    </style>
</head>
<body>

    <div id="loading-overlay"><div class="spinner"></div><p style="margin-top:10px; color:#fff;">Processing...</p></div>

    <header>
        <div class="logo">NDS LIVE</div>
        <div style="display:flex; align-items:center;">
            <button class="lang-btn" onclick="window.toggleLanguage()" id="lang-btn">தமிழ்</button>
            <div class="profile-icon" id="header-profile" onclick="window.handleProfileClick()"><i class="fas fa-user"></i></div>
        </div>
    </header>

    <div id="page-home" class="page-section active">
        <h2 style="padding:15px 20px; font-size:24px; font-weight:800;" data-key="feed_title">Today's Feed</h2>
        <div class="feed-container" id="feed-stream"></div>
    </div>

    <div id="page-live" class="page-section">
        <div class="sub-tab-container">
            <button class="sub-tab-btn active" onclick="window.switchSubTab('live', 'status')" data-key="tab_status">Live Status</button>
            <button class="sub-tab-btn" onclick="window.switchSubTab('live', 'video')" data-key="tab_video">Live Video</button>
        </div>
        <div id="live-status-content" class="sub-content active feed-container"><div id="list-live-status"></div></div>
        <div id="live-video-content" class="sub-content feed-container"><div id="list-live-video"></div></div>
    </div>

    <div id="page-events" class="page-section">
        <div class="sub-tab-container">
            <button class="sub-tab-btn active" onclick="window.switchSubTab('events', 'upcoming')" data-key="tab_upcoming">Upcoming</button>
            <button class="sub-tab-btn" onclick="window.switchSubTab('events', 'previous')" data-key="tab_previous">Previous Live</button>
        </div>
        <div id="events-upcoming-content" class="sub-content active feed-container"><div id="list-event-upcoming"></div></div>
        <div id="events-previous-content" class="sub-content feed-container"><div id="list-event-previous"></div></div>
    </div>

    <div id="page-news" class="page-section">
        <h2 style="padding:15px 20px; font-size:24px; font-weight:800;" data-key="news_title">Latest News</h2>
        <div class="feed-container" id="list-news"></div>
    </div>

    <div id="page-more" class="page-section">
        <h2 style="padding:15px 20px; font-size:24px; font-weight:800;" data-key="nav_more">More</h2>
        <div class="feed-container">
            
            <div class="more-link" onclick="document.getElementById('content-contact').classList.toggle('open')">
                <span data-key="link_contact">Contact Us</span> <i class="fas fa-chevron-down"></i>
            </div>
            <div id="content-contact" class="more-content">
                <div data-key="txt_contact"></div>
            </div>

            <div class="more-link" onclick="document.getElementById('content-privacy').classList.toggle('open')">
                <span data-key="link_privacy">Privacy Policy</span> <i class="fas fa-chevron-down"></i>
            </div>
            <div id="content-privacy" class="more-content">
                <div data-key="txt_privacy"></div>
            </div>

            <div class="more-link" onclick="document.getElementById('content-terms').classList.toggle('open')">
                <span data-key="link_terms">Terms & Conditions</span> <i class="fas fa-chevron-down"></i>
            </div>
            <div id="content-terms" class="more-content">
                <div data-key="txt_terms"></div>
            </div>

        </div>
    </div>

    <div id="page-profile" class="page-section">
        <div class="profile-hero">
            <div class="profile-big-avatar" id="profile-avatar">U</div>
            <div class="profile-name" id="profile-username">Username</div>
            <div class="profile-meta" data-key="member">Member</div>
            <button class="btn-logout" onclick="window.handleLogout()" data-key="logout">LOGOUT</button>
        </div>
        <div class="existing-section">
            <div class="existing-title" data-key="my_posts">My Posts</div>
            <div id="profile-posts-list"></div>
        </div>
    </div>

    <div id="page-login" class="page-section">
        <div class="auth-container">
            <div class="auth-card">
                <div class="auth-title" data-key="login_title">Welcome Back</div>
                <div class="admin-input-group"><input type="email" id="login-email" placeholder="Email"></div>
                <div class="admin-input-group"><input type="password" id="login-pass" placeholder="Password"></div>
                <button class="btn-save" onclick="window.handleLogin()" data-key="login_btn">LOGIN</button>
                <span class="auth-link" onclick="window.navTo('register', null)" data-key="create_acc">Create New Account</span>
            </div>
        </div>
    </div>

    <div id="page-register" class="page-section">
        <div class="auth-container">
            <div class="auth-card">
                <div class="auth-title" data-key="reg_title">Create Account</div>
                <div class="admin-input-group"><input type="text" id="reg-name" placeholder="Name"></div>
                <div class="admin-input-group"><input type="email" id="reg-email" placeholder="Email"></div>
                <div class="admin-input-group"><input type="password" id="reg-pass" placeholder="Password"></div>
                <button class="btn-save" onclick="window.handleRegister()" data-key="reg_btn">REGISTER</button>
                <span class="auth-link" onclick="window.navTo('login', null)" data-key="have_acc">Already have an account? Login</span>
            </div>
        </div>
    </div>

    <div id="page-admin" class="page-section">
        <div class="admin-header"><span class="admin-title">Admin Dashboard</span><span class="exit-btn" onclick="window.exitAdmin()">Exit</span></div>
        <div class="admin-tabs">
            <div class="admin-tab active" onclick="window.setAdminMode('live', this)">Live</div>
            <div class="admin-tab" onclick="window.setAdminMode('events', this)">Events</div>
            <div class="admin-tab" onclick="window.setAdminMode('news', this)">News</div>
        </div>
        <div class="admin-card">
            <input type="hidden" id="admin-current-mode" value="live">
            <input type="hidden" id="edit-post-id" value="">
            
            <div id="form-live" class="admin-form-container active">
                <div class="file-input-wrapper"><span class="file-custom-btn">File</span><span class="file-name" id="live-file-name">None</span><input type="file" id="live-file" onchange="window.updateFileName(this, 'live-file-name')"></div>
                <div class="admin-input-group"><input type="text" id="live-name" placeholder="Name"></div>
                <div class="admin-input-group"><input type="text" id="live-village" placeholder="Village"></div>
                <div class="admin-input-group"><input type="text" id="live-time" placeholder="Time (e.g. 5.66)"></div>
                <div class="admin-input-group"><input type="date" id="live-date"></div>
            </div>
            
            <div id="form-events" class="admin-form-container">
                <div class="file-input-wrapper"><span class="file-custom-btn">File</span><span class="file-name" id="event-file-name">None</span><input type="file" id="event-file" onchange="window.updateFileName(this, 'event-file-name')"></div>
                <div class="admin-input-group"><input type="text" id="event-name" placeholder="Event Name"></div>
                <div class="admin-input-group"><input type="text" id="event-loc" placeholder="Loc"></div>
                <div class="admin-input-group"><textarea id="event-desc" placeholder="Desc"></textarea></div>
                <div class="admin-input-group"><input type="date" id="event-date"></div>
            </div>
            
            <div id="form-news" class="admin-form-container">
                <div class="file-input-wrapper"><span class="file-custom-btn">File</span><span class="file-name" id="news-file-name">None</span><input type="file" id="news-file" onchange="window.updateFileName(this, 'news-file-name')"></div>
                <div class="admin-input-group"><textarea id="news-content" placeholder="Content"></textarea></div>
                <div class="admin-input-group"><input type="date" id="news-date"></div>
            </div>
            
            <button class="btn-save" id="btn-save-text" onclick="window.saveAdminPost()">SAVE POST</button>
            <button class="btn-cancel" id="btn-cancel" onclick="window.cancelEdit()">CANCEL</button>
        </div>
        <div class="existing-section"><div class="existing-title">Manage Posts</div><div id="admin-items-list"></div></div>
    </div>

    <div class="fab" onclick="window.handleFabClick()"><i class="fas fa-plus"></i></div>

    <div id="user-modal" class="modal">
        <div class="modal-content" style="text-align:left;">
            <div class="modal-title" data-key="create_post">Create Post</div>
            <input type="hidden" id="user-edit-id" value="">
            <div class="admin-input-group"><select id="user-cat" onchange="window.updateUserForm()"><option value="live">Live Update</option><option value="events">Event</option><option value="news">News</option></select></div>
            
            <div id="user-form-live" class="user-form-section active">
                <div class="admin-input-group"><input type="text" id="u-live-name" placeholder="Name"></div>
                <div class="admin-input-group"><input type="text" id="u-live-village" placeholder="Village"></div>
                <div class="admin-input-group"><input type="text" id="u-live-time" placeholder="Time (e.g. 5.66)"></div>
            </div>
            
            <div id="user-form-events" class="user-form-section">
                <div class="admin-input-group"><input type="text" id="u-event-name" placeholder="Event Name"></div>
                <div class="admin-input-group"><input type="text" id="u-event-loc" placeholder="Location"></div>
                <div class="admin-input-group"><textarea id="u-event-desc" placeholder="Details"></textarea></div>
            </div>
            
            <div id="user-form-news" class="user-form-section">
                <div class="admin-input-group"><textarea id="u-news-content" placeholder="Content"></textarea></div>
            </div>
            
            <div class="file-input-wrapper"><span class="file-custom-btn">Image</span><span class="file-name" id="user-file-name">Choose...</span><input type="file" id="user-file" accept="image/*" onchange="window.updateFileName(this, 'user-file-name')"></div>
            <button class="btn-save" id="btn-user-save" onclick="window.saveUserPost()" data-key="post_now">POST NOW</button>
            <button class="exit-btn" onclick="window.closeUserModal()" data-key="cancel" style="width:100%;color:#888;">CANCEL</button>
        </div>
    </div>

    <div id="password-modal" class="modal">
        <div class="modal-content"><h3 style="color:var(--brand-gold);text-align:center;margin-bottom:10px;">Admin</h3><input type="password" id="admin-password" placeholder="Password" style="width:100%;padding:10px;background:#222;border:1px solid #333;color:#fff;"><button class="btn-save" style="margin-top:10px;" onclick="window.checkPassword()">UNLOCK</button><button class="exit-btn" style="width:100%;margin-top:10px;color:#888;" onclick="window.closePasswordModal()">CANCEL</button></div>
    </div>
    <div id="lightbox-modal" class="lightbox-modal"><div class="lightbox-close" onclick="window.closeLightbox()">×</div><div id="lightbox-content" class="lightbox-content"></div></div>

    <div class="secret-footer" id="secret-footer-trigger">
        &copy; 2026 NDS LIVE. Vellore Bulls
    </div>

    
    <nav class="bottom-nav" id="main-nav">
        <button class="nav-item active" onclick="window.navTo('home', this)"><i class="fas fa-home"></i><span data-key="nav_home">HOME</span></button>
        <button class="nav-item" onclick="window.navTo('live', this)"><i class="fas fa-pause-circle"></i><span data-key="nav_live">LIVE</span></button>
        <button class="nav-item" onclick="window.navTo('events', this)"><i class="fas fa-calendar-alt"></i><span data-key="nav_events">EVENTS</span></button>
        <button class="nav-item" onclick="window.navTo('news', this)"><i class="fas fa-newspaper"></i><span data-key="nav_news">NEWS</span></button>
        <button class="nav-item" onclick="window.navTo('more', this)"><i class="fas fa-bars"></i><span data-key="nav_more">MORE</span></button>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, updateProfile } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDrYvK2sXIEV2sqppxN0knT-z0OZXdvdCM",
            authDomain: "nds-live-f20e0.firebaseapp.com",
            projectId: "nds-live-f20e0",
            storageBucket: "nds-live-f20e0.firebasestorage.app",
            messagingSenderId: "870905973772",
            appId: "1:870905973772:web:76ca32e380df96906bf229",
            measurementId: "G-9LFNL56N1Z"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const CLOUDINARY_URL = 'https://api.cloudinary.com/v1_1/di0fynckd/auto/upload';
        const CLOUDINARY_PRESET = 'imcwyygq';

        let posts = [];
        let currentUser = null;
        let currentLang = localStorage.getItem('nds_lang') || 'en';
        let isAdminUnlocked = false;

        const translations = {
            en: { 
                feed_title:"Today's Feed", nav_home:"HOME", nav_live:"LIVE", nav_events:"EVENTS", nav_news:"NEWS", nav_more:"MORE", 
                tab_status:"Live Status", tab_video:"Live Video", tab_upcoming:"Upcoming", tab_previous:"Previous Live", 
                news_title:"Latest News", member:"Member", logout:"LOGOUT", my_posts:"My Posts", 
                login_title:"Welcome Back", login_btn:"LOGIN", create_acc:"Create New Account", 
                reg_title:"Create Account", reg_btn:"REGISTER", have_acc:"Login instead?", 
                create_post:"Create Post", post_now:"POST NOW", cancel:"CANCEL", read_more:"Read More", show_less:"Show Less",
                
                // More Page Links
                link_contact: "Contact Us",
                link_privacy: "Privacy Policy",
                link_terms: "Terms & Conditions",

                // CONTACT CONTENT (English)
                txt_contact: `
                    <h2>Contact Us</h2>
                    <p>If you have any questions, concerns, or suggestions about NDS LIVE, feel free to reach out to us.</p>
                    <ul>
                        <li><strong>Email:</strong> <a href="mailto:support@ndslive.in" style="color:var(--brand-gold)">support@ndslive.in</a></li>
                        <li><strong>Address:</strong> NDS LIVE Support, Vellore, Tamil Nadu, India</li>
                        <li><strong>Social:</strong> Instagram / Facebook – @NDSLIVE</li>
                    </ul>`,

                // PRIVACY CONTENT (English)
                txt_privacy: `
                    <h2>Privacy Policy</h2>
                    <p><strong>Last Updated:</strong> Jan 2026</p>
                    <h3>1. Information We Collect</h3>
                    <p>We collect limited information required for using NDS LIVE, such as usernames and posts you create. We do not collect personal data like phone numbers, addresses, or payment information.</p>
                    <h3>2. Use of Information</h3>
                    <p>Your information is used only to manage your account, display posts, and improve the community experience. We never sell or share your information with third parties.</p>
                    <h3>3. Data Storage & Security</h3>
                    <p>All user data is securely stored. Reasonable measures are taken to protect data from unauthorized access or misuse.</p>
                    <h3>4. Cookies & Analytics</h3>
                    <p>NDS LIVE may use browser storage to keep you logged in. We do not use tracking cookies or external analytics that identify users.</p>
                    <h3>5. Your Rights</h3>
                    <p>You may request account deletion or correction of your data by contacting us at support@ndslive.in.</p>
                    <h3>6. Policy Updates</h3>
                    <p>This policy may be updated periodically. Major updates will be posted on our website.</p>`,

                // TERMS CONTENT (English)
                txt_terms: `
                    <h2>Terms & Conditions</h2>
                    <p><strong>Effective Date:</strong> Jan 2026</p>
                    <h3>1. Acceptance</h3>
                    <p>By accessing or using NDS LIVE, you agree to these Terms & Conditions and our Privacy Policy.</p>
                    <h3>2. User Responsibilities</h3>
                    <p>Users must not post offensive, misleading, or harmful content. Violations may result in account suspension or permanent removal.</p>
                    <h3>3. Content Ownership</h3>
                    <p>All NDS LIVE content related to Vellore Bulls remains the property of NDS LIVE. User posts remain their own content, but by posting, you grant NDS LIVE permission to display it publicly.</p>
                    <h3>4. Service Availability</h3>
                    <p>NDS LIVE may change or discontinue features at any time without notice. We strive to keep the service available but do not guarantee uninterrupted uptime.</p>
                    <h3>5. Limitation of Liability</h3>
                    <p>NDS LIVE is not responsible for any loss or damage arising from use of the service or user-generated content.</p>
                    <h3>6. Governing Law</h3>
                    <p>These Terms are governed by the laws of India.</p>`
            },
            ta: { 
                feed_title:"இன்றைய செய்திகள்", nav_home:"முகப்பு", nav_live:"நேரலை", nav_events:"நிகழ்வு", nav_news:"செய்தி", nav_more:"மேலும்", 
                tab_status:"நேரலை நிலவரம்", tab_video:"நேரலை காணொளி", tab_upcoming:"வரவிருக்கும்", tab_previous:"முந்தைய", 
                news_title:"சமீபத்திய செய்திகள்", member:"உறுப்பினர்", logout:"வெளியேறு", my_posts:"என் பதிவுகள்", 
                login_title:"நல்வரவு", login_btn:"உள்நுழைய", create_acc:"புதிய கணக்கை உருவாக்கு", 
                reg_title:"கணக்கு துவங்கு", reg_btn:"பதிவு செய்", have_acc:"உள்நுழைய வேண்டுமா?", 
                create_post:"பதிவிடவும்", post_now:"பதிவிடு", cancel:"ரத்து", read_more:"மேலும் படிக்க", show_less:"சுருக்க",
                
                // More Page Links (Tamil)
                link_contact: "தொடர்பு கொள்ள",
                link_privacy: "தனியுரிமைக் கொள்கை",
                link_terms: "விதிமுறைகள் & நிபந்தனைகள்",

                // CONTACT CONTENT (Tamil)
                txt_contact: `
                    <h2>எங்களை தொடர்பு கொள்ள</h2>
                    <p>NDS LIVE குறித்த கேள்விகள் அல்லது ஆலோசனைகளுக்கு எங்களை தொடர்பு கொள்ளலாம்.</p>
                    <ul>
                        <li><strong>மின்னஞ்சல்:</strong> <a href="mailto:support@ndslive.in" style="color:var(--brand-gold)">support@ndslive.in</a></li>
                        <li><strong>முகவரி:</strong> NDS LIVE Support, வேலூர், தமிழ்நாடு.</li>
                        <li><strong>சமூகம்:</strong> Instagram / Facebook – @NDSLIVE</li>
                    </ul>`,

                // PRIVACY CONTENT (Tamil)
                txt_privacy: `
                    <h2>தனியுரிமைக் கொள்கை</h2>
                    <p><strong>புதுப்பிக்கப்பட்டது:</strong> ஜனவரி 2026</p>
                    <h3>1. நாங்கள் சேகரிக்கும் தகவல்கள்</h3>
                    <p>பயனர் பெயர் மற்றும் பதிவுகள் போன்ற அடிப்படை தகவல்களை மட்டுமே சேகரிக்கிறோம். தொலைபேசி எண் அல்லது வங்கி விவரங்களை சேகரிப்பதில்லை.</p>
                    <h3>2. தகவலின் பயன்பாடு</h3>
                    <p>உங்கள் கணக்கை நிர்வகிக்கவும், பதிவுகளைக் காட்டவும் மட்டுமே இது பயன்படுத்தப்படுகிறது. மூன்றாம் தரப்பினருக்கு விற்பனை செய்வதில்லை.</p>
                    <h3>3. தரவு பாதுகாப்பு</h3>
                    <p>அனைத்து பயனர் தரவுகளும் பாதுகாப்பாக சேமிக்கப்படுகின்றன.</p>
                    <h3>4. குக்கீகள்</h3>
                    <p>உள்நுழைவு வசதிக்காக மட்டுமே பிரவுசர் சேமிப்பகம் பயன்படுத்தப்படுகிறது.</p>
                    <h3>5. உங்கள் உரிமைகள்</h3>
                    <p>கணக்கை நீக்க support@ndslive.in ஐ தொடர்பு கொள்ளவும்.</p>`,

                // TERMS CONTENT (Tamil)
                txt_terms: `
                    <h2>விதிமுறைகள் மற்றும் நிபந்தனைகள்</h2>
                    <p><strong>தேதி:</strong> ஜனவரி 2026</p>
                    <h3>1. ஏற்பு</h3>
                    <p>NDS LIVE ஐ பயன்படுத்துவதன் மூலம், இந்த விதிமுறைகளை ஒப்புக்கொள்கிறீர்கள்.</p>
                    <h3>2. பயனர் பொறுப்புகள்</h3>
                    <p>தவறான அல்லது புண்படுத்தும் உள்ளடக்கத்தைப் பதிவிடக்கூடாது. மீறினால் கணக்கு நீக்கப்படும்.</p>
                    <h3>3. உள்ளடக்க உரிமை</h3>
                    <p>வேலூர் காளைகள் தொடர்பான அனைத்து உள்ளடக்கங்களும் NDS LIVE க்கு சொந்தமானவை.</p>
                    <h3>4. சேவை கிடைக்கும் தன்மை</h3>
                    <p>எந்த நேரத்திலும் சேவையில் மாற்றங்கள் ஏற்படலாம்.</p>
                    <h3>5. பொறுப்புத்துறப்பு</h3>
                    <p>சேவையைப் பயன்படுத்துவதால் ஏற்படும் இழப்புகளுக்கு NDS LIVE பொறுப்பல்ல.</p>
                    <h3>6. சட்டம்</h3>
                    <p>இந்த விதிமுறைகள் இந்திய சட்டங்களுக்கு உட்பட்டவை.</p>`
            }
        };

        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            updateProfileIcon();
            if(user) {
                if(document.getElementById('page-profile').classList.contains('active')) renderProfilePosts();
            } else {
                // If not logged in, force login screen
                window.navTo('login', null);
            }
        });

        // --- GLOBAL EXPORTS ---
        window.handleRegister = async () => {
            const n=document.getElementById('reg-name').value; const e=document.getElementById('reg-email').value; const p=document.getElementById('reg-pass').value;
            if(!n||!e||!p) return alert("Fill all fields");
            showLoading(true);
            try {
                const cred = await createUserWithEmailAndPassword(auth, e, p);
                await updateProfile(cred.user, { displayName: n });
                showLoading(false); alert("Welcome!"); window.navTo('home', document.querySelector('.nav-item'));
            } catch(err) { showLoading(false); alert(err.message); }
        };

        window.handleLogin = async () => {
            const e=document.getElementById('login-email').value; const p=document.getElementById('login-pass').value;
            showLoading(true);
            try {
                await signInWithEmailAndPassword(auth, e, p);
                showLoading(false); window.navTo('home', document.querySelector('.nav-item'));
            } catch(err) { showLoading(false); alert("Invalid Credentials"); }
        };

        window.handleLogout = async () => { await signOut(auth); window.navTo('login', null); };

        const q = query(collection(db, "posts")); 
        onSnapshot(q, (snapshot) => {
            posts = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderAll();
            if(document.getElementById('page-profile').classList.contains('active')) renderProfilePosts();
        });

        async function uploadFile(file) {
            const formData = new FormData();
            formData.append('file', file);
            formData.append('upload_preset', CLOUDINARY_PRESET);
            const res = await fetch(CLOUDINARY_URL, { method: 'POST', body: formData });
            const data = await res.json();
            return data.secure_url;
        }

        // POSTING LOGIC
        window.saveAdminPost = async () => { savePostGeneric(true); };
        window.saveUserPost = async () => { savePostGeneric(false); };

        async function savePostGeneric(isAdmin) {
            const mode = isAdmin ? document.getElementById('admin-current-mode').value : document.getElementById('user-cat').value;
            const editId = isAdmin ? document.getElementById('edit-post-id').value : document.getElementById('user-edit-id').value;
            
            // Map IDs based on mode
            let ids = {};
            if(isAdmin) {
                if(mode=='live'){ ids={n:'live-name',v:'live-village',t:'live-time',d:'live-date',f:'live-file'}; }
                else if(mode=='events'){ ids={n:'event-name',v:'event-loc',desc:'event-desc',d:'event-date',f:'event-file'}; }
                else { ids={desc:'news-content',d:'news-date',f:'news-file'}; }
            } else {
                if(mode=='live'){ ids={n:'u-live-name',v:'u-live-village',t:'u-live-time'}; }
                else if(mode=='events'){ ids={n:'u-event-name',v:'u-event-loc',desc:'u-event-desc'}; }
                else { ids={desc:'u-news-content'}; }
            }

            let post = { category: mode, isAdmin: isAdmin, author: isAdmin?'Admin':(currentUser.displayName||'User'), timestamp: Date.now() };
            if(isAdmin && !post.likes) post.likes=0;

            // Gather Data
            if(ids.n) post.title = document.getElementById(ids.n).value;
            if(ids.v) post.village = document.getElementById(ids.v).value;
            if(ids.t) post.time = document.getElementById(ids.t).value;
            if(ids.d) post.date = document.getElementById(ids.d).value;
            if(ids.desc) {
                if(mode === 'news' || (!ids.n)) post.title = "News Update";
                post.desc = document.getElementById(ids.desc).value;
            }

            // Image Handle
            const fileInput = document.getElementById(isAdmin ? ids.f : 'user-file');
            
            if(!post.title && !post.desc) return alert("Missing info");
            
            showLoading(true);
            try {
                if(fileInput && fileInput.files[0]) {
                    post.mediaSrc = await uploadFile(fileInput.files[0]);
                    post.mediaType = fileInput.files[0].type.startsWith('video') ? 'video' : 'image';
                } else if(!editId) {
                    showLoading(false); return alert("Image/Video Required");
                }

                if(editId) {
                    await updateDoc(doc(db, "posts", editId), post);
                    alert("Updated");
                } else {
                    post.likes = 0;
                    await addDoc(collection(db, "posts"), post);
                    alert("Posted");
                }
                
                if(isAdmin) window.cancelEdit(); else window.closeUserModal();
            } catch(e) { console.error(e); alert("Error: " + e.message); }
            showLoading(false);
        }

        window.deletePost = async (id) => {
            if(confirm("Delete this post?")) {
                showLoading(true);
                await deleteDoc(doc(db, "posts", id));
                showLoading(false);
            }
        };

        window.toggleFolder = (id) => {
    const el = document.getElementById(id);
    const icon = document.getElementById('icon-' + id);
    if (el.style.display === 'block') {
        el.style.display = 'none';
        icon.className = 'fas fa-chevron-down';
    } else {
        el.style.display = 'block';
        icon.className = 'fas fa-chevron-up';
    }
};

        // UI HELPERS
        window.navTo = (p, b) => { document.querySelectorAll('.page-section').forEach(e=>e.classList.remove('active')); document.getElementById('page-'+p).classList.add('active'); if(b){ document.querySelectorAll('.nav-item').forEach(e=>e.classList.remove('active')); b.classList.add('active'); } window.scrollTo(0,0); };
        window.switchSubTab = (p, s) => { document.querySelectorAll(`#page-${p} .sub-tab-btn`).forEach(b=>b.classList.remove('active')); event.target.classList.add('active'); document.querySelectorAll(`#page-${p} .sub-content`).forEach(e=>e.classList.remove('active')); document.getElementById(`${p}-${s}-content`).classList.add('active'); };
        window.updateFileName = (i,d) => { document.getElementById(d).innerText = i.files[0] ? i.files[0].name : "None"; };
        window.setAdminMode = (m, b) => { document.getElementById('admin-current-mode').value=m; document.querySelectorAll('.admin-tab').forEach(t=>t.classList.remove('active')); b.classList.add('active'); document.querySelectorAll('.admin-form-container').forEach(f=>f.classList.remove('active')); document.getElementById('form-'+m).classList.add('active'); };
        window.editAdminPost = (id) => { const p=posts.find(x=>x.id===id); window.navTo('admin',null); window.setAdminMode(p.category, document.querySelector(`.admin-tab:nth-child(${p.category=='live'?1:p.category=='events'?2:3})`)); document.getElementById('edit-post-id').value=id; if(p.category=='live'){document.getElementById('live-name').value=p.title;document.getElementById('live-village').value=p.village;document.getElementById('live-time').value=p.time;} else if(p.category=='events'){document.getElementById('event-name').value=p.title;document.getElementById('event-loc').value=p.village;document.getElementById('event-desc').value=p.desc;} else{document.getElementById('news-content').value=p.desc;} document.getElementById('btn-save-text').innerText="UPDATE"; document.getElementById('btn-cancel').style.display='block'; };
        window.cancelEdit = () => { document.getElementById('edit-post-id').value=""; document.getElementById('btn-save-text').innerText="SAVE POST"; document.getElementById('btn-cancel').style.display='none'; document.querySelectorAll('.admin-card input,.admin-card textarea').forEach(i=>i.value=''); };
        window.handleFabClick = () => { if(!currentUser) {if(confirm("Login?")) window.navTo('login',null);} else document.getElementById('user-modal').style.display='flex'; };
        window.closeUserModal = () => document.getElementById('user-modal').style.display='none';
        window.updateUserForm = () => { const c=document.getElementById('user-cat').value; document.querySelectorAll('.user-form-section').forEach(e=>e.classList.remove('active')); document.getElementById('user-form-'+c).classList.add('active'); };
        window.checkPassword = () => { if(document.getElementById('admin-password').value==='admin123'){document.getElementById('password-modal').style.display='none'; isAdminUnlocked=true; window.navTo('admin',null);}else alert("Incorrect"); };
        window.closePasswordModal = () => document.getElementById('password-modal').style.display='none';
        window.exitAdmin = () => { window.cancelEdit(); window.navTo('home', document.querySelector('.nav-item')); };
        window.openLightbox = (s,t) => { const c=document.getElementById('lightbox-content'); if(t=='video') c.innerHTML=`<video src="${s}" controls autoplay style="max-width:100%;max-height:90vh;"></video>`; else c.innerHTML=`<img src="${s}" style="max-width:100%;max-height:90vh;">`; document.getElementById('lightbox-modal').style.display='flex'; };
        window.closeLightbox = () => { document.getElementById('lightbox-modal').style.display='none'; document.getElementById('lightbox-content').innerHTML=''; };
        window.toggleReadMore = (id) => { const s=document.getElementById(`desc-short-${id}`); const f=document.getElementById(`desc-full-${id}`); const b=document.getElementById(`btn-read-${id}`); if(s.style.display=='none'){s.style.display='inline';f.style.display='none';b.innerText=getTrans('read_more');}else{s.style.display='none';f.style.display='inline';b.innerText=getTrans('show_less');} };
        window.handleProfileClick = () => { if(currentUser) { window.navTo('profile', null); document.getElementById('profile-username').innerText = currentUser.displayName || 'User'; document.getElementById('profile-avatar').innerText = (currentUser.displayName||'U').charAt(0).toUpperCase(); renderProfilePosts(); } else window.navTo('login', null); };
window.toggleLike = async (id) => {
            // 1. Check Login
            if(!currentUser) {
                if(confirm("Please login to like posts.")) window.navTo('login', null);
                return;
            }

            const p = posts.find(x => x.id === id);
            if(p){
                // 2. Get existing likes array (or empty array if new)
                let likes = Array.isArray(p.likes) ? p.likes : [];
                
                const uid = currentUser.email; 

                // 3. Toggle Logic
                if(likes.includes(uid)) {
                    likes = likes.filter(u => u !== uid); // Remove user (Unlike)
                } else {
                    likes.push(uid); // Add user (Like)
                }

                // 4. Save to Database
                await updateDoc(doc(db,"posts",id), { likes: likes });
            }
        };        window.sharePost = (id) => { const p=posts.find(x=>x.id===id); if(navigator.share) navigator.share({title:'NDS LIVE',text:p.title,url:window.location.href}); else alert("Link copied!"); };
        window.toggleComments = (id) => document.getElementById(`comments-${id}`).classList.toggle('open');
        window.addComment = async (id) => { const i=document.getElementById(`comment-input-${id}`); if(!i.value)return; const p=posts.find(x=>x.id===id); const c=p.comments||[]; c.push({user:currentUser.displayName||'Guest',text:i.value}); await updateDoc(doc(db,"posts",id),{comments:c}); i.value=''; };
        window.toggleLanguage = () => { currentLang=currentLang==='en'?'ta':'en'; localStorage.setItem('nds_lang',currentLang); applyLanguage(); };

        function showLoading(show) { document.getElementById('loading-overlay').style.display = show ? 'flex' : 'none'; }
        function updateProfileIcon() { const i=document.getElementById('header-profile'); if(currentUser){i.classList.add('active');i.innerText=currentUser.displayName?currentUser.displayName.charAt(0).toUpperCase():'U';}else{i.classList.remove('active');i.innerHTML='<i class="fas fa-user"></i>';} }
function applyLanguage() {
            document.getElementById('lang-btn').innerText = currentLang === 'en' ? 'தமிழ்' : 'ENG';
            document.querySelectorAll('[data-key]').forEach(el => {
                const k = el.getAttribute('data-key');
                if(translations[currentLang][k]) {
                    // CHANGED FROM innerText TO innerHTML to support <h2>, <ul>, etc.
                    el.innerHTML = translations[currentLang][k]; 
                }
            });
            renderAll();
        }        function getTrans(k) { return translations[currentLang][k] || k; }

        function renderAll() {
    // 1. Clear Targets
    const targets = { 'home': 'feed-stream', 'live_status': 'list-live-status', 'live_video': 'list-live-video', 'events_upcoming': 'list-event-upcoming', 'prev_live': 'list-event-previous', 'news_list': 'list-news', 'admin_list': 'admin-items-list' };
    for(let key in targets) {
        const el = document.getElementById(targets[key]);
        if(el) el.innerHTML = '';
    }

    // 2. Calculate "Active Date" (1:00 AM Logic)
    // Subtract 1 hour (3600000ms) to shift the "day change" from Midnight to 1:00 AM
    const activeDate = new Date(Date.now() - 3600000).toISOString().split('T')[0];

    // 3. Sort Posts (Newest First for Feed)
    const sortedPosts = [...posts].sort((a,b) => b.timestamp - a.timestamp);

    // 4. Separate Live Posts
    const currentLivePosts = [];
    const pastLivePosts = [];

    // 5. PROCESS ALL POSTS
    sortedPosts.forEach(post => {
        // --- ADMIN LIST (Show Everything) ---
        let thumb = post.mediaType === 'video' ? `<i class="fas fa-video"></i>` : `<img src="${post.mediaSrc}" class="existing-thumb">`;
        document.getElementById('admin-items-list').insertAdjacentHTML('beforeend', `<div class="existing-item"><div style="width:50px;text-align:center;">${thumb}</div><div class="existing-info"><span class="existing-name">${post.title}</span><span class="existing-meta">${post.category}</span></div><div class="action-buttons"><button class="btn-action btn-edit" onclick="window.editAdminPost('${post.id}')">EDIT</button><button class="btn-action btn-del" onclick="window.deletePost('${post.id}')">DEL</button></div></div>`);

        // --- CATEGORY SORTING ---
        
        // EVENTS & NEWS: Always go to Home + Tabs
        if (post.category === 'events') {
            renderPostCard(post, 'home');
            renderPostCard(post, 'events_upcoming');
        } else if (post.category === 'news') {
            renderPostCard(post, 'home');
            renderPostCard(post, 'news_list');
        } 
        
        // LIVE POSTS: Strict Filtering
        else if (post.category === 'live') {
            if (post.date === activeDate) {
                // IT IS TODAY (Before 1 AM next day) -> Show in Home & Live Tabs
                currentLivePosts.push(post);
                renderPostCard(post, 'home'); 
            } else {
                // IT IS OLD -> Remove from Home, Send to Archive
                pastLivePosts.push(post);
            }
        }
    });

    // 6. RENDER CURRENT LIVE TABS (Sorted by Time: Low -> High)
    const liveStatus = currentLivePosts.filter(p => p.mediaType !== 'video');
    liveStatus.sort((a, b) => (parseFloat(a.time) || 9999) - (parseFloat(b.time) || 9999));
    liveStatus.forEach(post => renderPostCard(post, 'live_status'));

    const liveVideos = currentLivePosts.filter(p => p.mediaType === 'video');
    liveVideos.forEach(post => renderPostCard(post, 'live_video'));

    // 7. RENDER PREVIOUS LIVE (FOLDERS)
    const prevContainer = document.getElementById('list-event-previous');
    
    // Group by Date
    const groupedPast = pastLivePosts.reduce((acc, post) => {
        (acc[post.date] = acc[post.date] || []).push(post);
        return acc;
    }, {});

    // Sort Dates (Newest Folder First)
    Object.keys(groupedPast).sort().reverse().forEach(dateKey => {
        const folderId = `folder-${dateKey}`;
        
        // Create Folder Header
        const folderHTML = `
            <div class="folder-header" onclick="window.toggleFolder('${folderId}')">
                <span><i class="fas fa-calendar-day"></i> ${dateKey}</span>
                <i id="icon-${folderId}" class="fas fa-chevron-down"></i>
            </div>
            <div id="${folderId}" class="folder-content">
                </div>
        `;
        prevContainer.insertAdjacentHTML('beforeend', folderHTML);

        // Sort posts inside the folder (Low Time -> High Time)
        const dayPosts = groupedPast[dateKey].sort((a, b) => (parseFloat(a.time) || 9999) - (parseFloat(b.time) || 9999));
        const folderDiv = document.getElementById(folderId);

        dayPosts.forEach(post => {
            // Manual Card Generation for Folder (Simplified View)
            let fTime = post.time || "0.00"; if(!fTime.toLowerCase().endsWith('s')) fTime+='s';
            let mediaHtml = post.mediaType === 'video' 
                ? `<video src="${post.mediaSrc}" controls style="width:100%; border-radius:8px; margin-top:5px;"></video>` 
                : `<img src="${post.mediaSrc}" onclick="window.openLightbox('${post.mediaSrc}','image')" style="width:100%; border-radius:8px; margin-top:5px;">`;
            
            const html = `
            <div class="card" style="border: 1px solid #333; margin-bottom:15px; background: #000;">
                <div class="card-content">
                    ${mediaHtml}
                    <div class="live-footer">
                        <div class="bull-name" style="font-size:16px;">${post.title}</div>
                        <div class="bull-time" style="font-size:32px;">${fTime}</div>
                    </div>
                    <div style="font-size:12px; color:#666; margin-top:5px;">${post.village}</div>
                </div>
            </div>`;
            folderDiv.insertAdjacentHTML('beforeend', html);
        });
    });

    if (Object.keys(groupedPast).length === 0) {
        prevContainer.innerHTML = '<div style="text-align:center; color:#555; padding:20px; font-size:12px;">No previous records found.</div>';
    }
}

        function renderPostCard(post, target) {
            let container = null;
            if(target === 'home') container = document.getElementById('feed-stream');
            if(target === 'live_status') container = document.getElementById('list-live-status');
            if(target === 'live_video') container = document.getElementById('list-live-video');
            if(target === 'events_upcoming') container = document.getElementById('list-event-upcoming');
            if(target === 'news_list') container = document.getElementById('list-news');
            if(!container) return;

            // --- LIKE LOGIC UI ---
            // Ensure likes is an array
            const likesArr = Array.isArray(post.likes) ? post.likes : [];
            const likeCount = likesArr.length;
            // Check if current user is in the list
            const isLiked = currentUser && likesArr.includes(currentUser.email);
            // Red Heart (fas) vs Outline Heart (far)
            const heartIcon = isLiked ? 'fas fa-heart' : 'far fa-heart';
            const btnClass = isLiked ? 'social-btn liked' : 'social-btn';

            // Layout Logic
            let isLiveStatus = (post.category === 'live' && post.mediaType !== 'video');
            let mediaHtml = post.mediaType === 'video' ? `<video src="${post.mediaSrc}" muted onclick="window.openLightbox('${post.mediaSrc}','video')"></video>` : `<img src="${post.mediaSrc}" onclick="window.openLightbox('${post.mediaSrc}','image')">`;
            const avatarClass = post.isAdmin ? 'nds' : 'user';
            const avatarText = post.isAdmin ? 'N' : post.author.charAt(0).toUpperCase();
            
            let descHtml = '';
            if(post.desc) {
                if(post.desc.length > 100) {
                    const short = post.desc.substring(0, 100) + "...";
                    descHtml = `<div class="card-desc"><span id="desc-short-${post.id}">${short}</span><span id="desc-full-${post.id}" style="display:none">${post.desc}</span><span class="read-more-btn" id="btn-read-${post.id}" onclick="window.toggleReadMore('${post.id}')">${getTrans('read_more')}</span></div>`;
                } else descHtml = `<div class="card-desc">${post.desc}</div>`;
            }

            let commentsHtml = '';
            if(post.comments) { post.comments.forEach(c => commentsHtml += `<div class="comment-item"><b>${c.user}:</b>${c.text}</div>`); }

            let cardContent = '';
            
            // --- LIVE STATUS CARD ---
            if (isLiveStatus) {
                let fTime = post.time || "0.00"; if(!fTime.toLowerCase().endsWith('s')) fTime+='s';
                cardContent = `
                <div class="card">
                    <div class="card-header"><div class="avatar ${avatarClass}">${avatarText}</div><div class="user-info"><h4>${post.isAdmin?'NDS LIVE':post.author}</h4><span>${post.village}</span></div></div>
                    <div class="card-content">${mediaHtml}<div class="live-footer"><div class="bull-name">${post.title}</div><div class="bull-time">${fTime}</div></div></div>
                    <div class="card-social">
                        <button class="${btnClass}" onclick="window.toggleLike('${post.id}')"><i class="${heartIcon}"></i> ${likeCount}</button>
                        <button class="social-btn" onclick="window.toggleComments('${post.id}')"><i class="far fa-comment"></i> ${post.comments?post.comments.length:0}</button>
                        <button class="social-btn" onclick="window.sharePost('${post.id}')"><i class="fas fa-share"></i> Share</button>
                    </div>
                    <div class="comments-section" id="comments-${post.id}">
                        ${commentsHtml}
                        <div class="comment-input-box"><input type="text" class="comment-input" id="comment-input-${post.id}" placeholder="Write..."><button class="comment-send" onclick="window.addComment('${post.id}')"><i class="fas fa-paper-plane"></i></button></div>
                    </div>
                </div>`;
            } 
            // --- STANDARD CARD (Events/News/LiveVideo) ---
            else {
                let meta = post.category === 'events' ? `${post.village} • ${post.date}` : post.category === 'news' ? post.date : `${post.village} • ${post.time}`;
                cardContent = `
                <div class="card">
                    <div class="card-header"><div class="avatar ${avatarClass}">${avatarText}</div><div class="user-info"><h4>${post.title}</h4><span>${meta}</span></div></div>
                    <div class="card-content">${mediaHtml}${descHtml}</div>
                    <div class="card-social">
                        <button class="${btnClass}" onclick="window.toggleLike('${post.id}')"><i class="${heartIcon}"></i> ${likeCount}</button>
                        <button class="social-btn" onclick="window.toggleComments('${post.id}')"><i class="far fa-comment"></i> ${post.comments?post.comments.length:0}</button>
                        <button class="social-btn" onclick="window.sharePost('${post.id}')"><i class="fas fa-share"></i> Share</button>
                    </div>
                    <div class="comments-section" id="comments-${post.id}">
                        ${commentsHtml}
                        <div class="comment-input-box"><input type="text" class="comment-input" id="comment-input-${post.id}" placeholder="Write a comment..."><button class="comment-send" onclick="window.addComment('${post.id}')"><i class="fas fa-paper-plane"></i></button></div>
                    </div>
                </div>`;
            }
            container.insertAdjacentHTML('beforeend', cardContent);
        }

        function renderProfilePosts() {
            const list = document.getElementById('profile-posts-list'); list.innerHTML = '';
            if(!currentUser) return;
            const myPosts = posts.filter(p => p.author === (currentUser.displayName || 'User') || (isAdminUnlocked && p.isAdmin));
            myPosts.forEach(post => {
                let thumb = post.mediaType === 'video' ? `<i class="fas fa-video"></i>` : `<img src="${post.mediaSrc}" class="existing-thumb">`;
                list.insertAdjacentHTML('beforeend', `<div class="existing-item"><div style="width:50px;text-align:center;">${thumb}</div><div class="existing-info"><span class="existing-name">${post.title}</span><span class="existing-meta">${post.category}</span></div><div class="action-buttons"><button class="btn-action btn-del" onclick="window.deletePost('${post.id}')">DEL</button></div></div>`);
            });
        }

       // --- FOOTER SECURITY ---
        let tapCount=0, tapTimer;
        const footerTrigger = document.getElementById('secret-footer-trigger');
        if (footerTrigger) {
            footerTrigger.addEventListener('click', () => { 
                tapCount++; 
                clearTimeout(tapTimer); 
                tapTimer=setTimeout(()=>{tapCount=0},800); 
                if(tapCount===5){document.getElementById('password-modal').style.display='flex';tapCount=0;} 
            });
        }

        const today = new Date().toISOString().split('T')[0];
        document.getElementById('live-date').value = today;
        document.getElementById('event-date').value = today;
        document.getElementById('news-date').value = today;
        applyLanguage();
    </script>
</body>
</html>

